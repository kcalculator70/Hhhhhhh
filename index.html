<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Real Proof Maker (Smart)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/piexifjs/1.0.6/piexif.js"></script>
    <style>
        :root {
            --bg-color: #e0e5ec;
            --text-color: #4a4a4a;
            --shadow-light: #ffffff;
            --shadow-dark: #a3b1c6;
            --accent: #007bff;
            --success: #00b894;
            --danger: #ff4757;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Segoe UI', sans-serif;
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; margin: 0;
        }

        .mobile-container {
            width: 90%; max-width: 400px;
            background-color: var(--bg-color);
            border-radius: 20px; padding: 20px;
            box-shadow: 10px 10px 20px var(--shadow-dark), -10px -10px 20px var(--shadow-light);
            min-height: 600px; position: relative; overflow: hidden;
            text-align: center;
        }

        h2 { text-align: center; color: var(--text-color); margin-bottom: 20px; }

        .neu-btn {
            width: 100%; padding: 15px; border: none; border-radius: 12px;
            background: var(--bg-color);
            box-shadow: 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light);
            color: var(--text-color); font-weight: bold; font-size: 16px;
            cursor: pointer; outline: none; transition: 0.2s; margin-bottom: 15px;
            display: flex; align-items: center; justify-content: center;
        }
        .neu-btn:active { box-shadow: inset 4px 4px 8px var(--shadow-dark), inset -4px -4px 8px var(--shadow-light); }
        .neu-btn:disabled { color: #aaa; box-shadow: none; cursor: not-allowed; }

        .btn-select { color: var(--accent); }
        .btn-save { color: var(--success); }

        .upload-area {
            text-align: center; padding: 20px; border-radius: 15px;
            box-shadow: inset 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light);
            margin-bottom: 25px;
        }
        
        input[type="file"] { display: none; }
        
        #preview {
            width: 150px; height: 150px; object-fit: contain; border-radius: 10px;
            margin-top: 15px; display: none;
            box-shadow: 4px 4px 8px var(--shadow-dark), -4px -4px 8px var(--shadow-light);
            border: 3px solid var(--bg-color);
            margin-left: auto; margin-right: auto;
        }

        .status-box {
            padding: 15px; border-radius: 12px; margin-bottom: 20px; font-size: 14px; font-weight: bold;
            display: none;
        }
        .status-error { color: var(--danger); box-shadow: inset 3px 3px 6px var(--shadow-dark), inset -3px -3px 6px var(--shadow-light); }
        .status-ok { color: var(--success); box-shadow: 6px 6px 12px var(--shadow-dark), -6px -6px 12px var(--shadow-light); }

        .modal-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(224, 229, 236, 0.95); z-index: 100;
            display: none; justify-content: center; align-items: center;
        }
        .modal-box {
            background: var(--bg-color); padding: 25px; border-radius: 20px;
            box-shadow: 10px 10px 20px var(--shadow-dark), -10px -10px 20px var(--shadow-light);
            text-align: center; width: 85%;
        }
    </style>
</head>
<body>

    <div class="mobile-container">
        <h2>üìç Proof Maker <span style="font-size:12px; color:green">(Auto)</span></h2>

        <div class="modal-overlay" id="locationModal">
            <div class="modal-box">
                <h3 style="color:var(--danger)">‚ö†Ô∏è ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶Ö‡¶´!</h3>
                <p>‡¶è‡¶á ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡ßü‡¶æ‡¶≤‡¶ø ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡ßÅ‡¶Ø‡ßã‡¶ó ‡¶®‡ßá‡¶á‡•§</p>
                <p style="font-size:13px; color:#666;">‡¶¶‡ßü‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤‡ßá‡¶∞ GPS ‡¶Ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
                <button class="neu-btn" onclick="checkLocation()" style="color:var(--accent)">üîÑ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </div>

        <div class="upload-area">
            <input type="file" id="fileInput" accept="image/jpeg, image/jpg, image/png">
            <button class="neu-btn btn-select" onclick="document.getElementById('fileInput').click()">
                üìÇ ‡¶õ‡¶¨‡¶ø ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®
            </button>
            <img id="preview" src="">
        </div>

        <div id="statusBox" class="status-box"></div>

        <div id="actionButtons" style="display:none;">
            <button id="saveBtn" class="neu-btn btn-save" onclick="injectAndSave()" disabled>
                üíæ ‡¶™‡ßç‡¶∞‡ßÅ‡¶´ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶® (Save)
            </button>
            <p style="font-size:11px; color:#666; margin-top:10px;">*‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶®‡¶æ‡¶Æ ‡¶è‡¶¨‡¶Ç ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶∏‡ßá‡¶≠ ‡¶π‡¶¨‡ßá‡•§</p>
        </div>

    </div>

    <script>
        let currentImgData = null;
        let userLat = null;
        let userLng = null;

        document.getElementById('fileInput').addEventListener('change', function(e) {
            let file = e.target.files[0];
            if (file) {
                let reader = new FileReader();
                reader.onload = function(event) {
                    currentImgData = event.target.result;
                    let img = document.getElementById('preview');
                    img.src = currentImgData;
                    img.style.display = 'block';
                    
                    document.querySelector('.btn-select').innerText = "üîÑ ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶õ‡¶¨‡¶ø ‡¶®‡¶ø‡¶®";
                    document.getElementById('actionButtons').style.display = 'block';
                    
                    userLat = null; userLng = null;
                    checkLocation();
                }
                reader.readAsDataURL(file);
            }
        });

        function checkLocation() {
            let statusBox = document.getElementById('statusBox');
            let modal = document.getElementById('locationModal');
            let saveBtn = document.getElementById('saveBtn');

            statusBox.style.display = 'block';
            statusBox.className = 'status-box status-error';
            statusBox.innerText = "‚è≥ ‡¶∏‡ßç‡¶Ø‡¶æ‡¶ü‡ßá‡¶≤‡¶æ‡¶á‡¶ü ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶ñ‡ßã‡¶Å‡¶ú‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
            modal.style.display = 'none';

            if ("geolocation" in navigator) {
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        userLat = position.coords.latitude;
                        userLng = position.coords.longitude;

                        saveBtn.disabled = false;
                        statusBox.className = 'status-box status-ok';
                        statusBox.innerHTML = `‚úÖ ‡¶ú‡¶ø‡¶™‡¶ø‡¶è‡¶∏ ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶°!<br><span style="font-size:10px">Lat: ${userLat.toFixed(5)}, Lng: ${userLng.toFixed(5)}</span>`;
                    },
                    function(error) {
                        console.log("GPS Error: ", error);
                        modal.style.display = 'flex';
                        statusBox.innerText = "‚ùå ‡¶ú‡¶ø‡¶™‡¶ø‡¶è‡¶∏ ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡¶∂‡¶® ‡¶®‡ßá‡¶á!";
                        saveBtn.disabled = true;
                    },
                    { enableHighAccuracy: true, timeout: 10000 }
                );
            } else {
                alert("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏‡ßá ‡¶ú‡¶ø‡¶™‡¶ø‡¶è‡¶∏ ‡¶®‡ßá‡¶á!");
            }
        }

        function injectAndSave() {
            if (!currentImgData || !userLat) {
                alert("‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø! ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ ‡¶Ö‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨‡•§");
                return;
            }

            let zeroth = {};
            let exif = {};
            let gps = {};

            // ------- ‡¶è‡¶á ‡¶™‡¶æ‡¶∞‡ßç‡¶ü‡¶ü‡¶æ ‡¶®‡¶§‡ßÅ‡¶® (‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶°‡¶ø‡¶ü‡ßá‡¶ï‡¶∂‡¶®) -------
            let userAgent = navigator.userAgent;
            let deviceName = "Unknown Mobile";
            let deviceBrand = "Smartphone";

            // ‡¶ñ‡ßÅ‡¶¨ ‡¶∏‡¶ø‡¶Æ‡ßç‡¶™‡¶≤ ‡¶°‡¶ø‡¶ü‡ßá‡¶ï‡¶∂‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï
            if(userAgent.indexOf("Android") > -1) {
                let match = userAgent.match(/Android.*?; (.*?)\)/);
                if (match && match[1]) {
                    deviceName = match[1];
                    deviceBrand = deviceName.split(" ")[0]; // ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶∂‡¶¨‡ßç‡¶¶‡¶ü‡¶æ‡¶ï‡ßá ‡¶¨‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶° ‡¶ß‡¶∞‡¶≤‡¶æ‡¶Æ
                }
            } else if (userAgent.indexOf("iPhone") > -1) {
                deviceName = "iPhone";
                deviceBrand = "Apple";
            }

            // ‡¶°‡¶ø‡¶ü‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶®‡¶æ‡¶Æ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Æ‡ßá‡¶ü‡¶æ‡¶°‡¶æ‡¶ü‡¶æ‡¶§‡ßá ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
            zeroth[piexif.ImageIFD.Make] = deviceBrand;
            zeroth[piexif.ImageIFD.Model] = deviceName;
            zeroth[piexif.ImageIFD.Software] = "Smart Proof Maker v2.0";
            // ----------------------------------------------------

            // ‡¶ü‡¶æ‡¶á‡¶Æ‡¶∏‡ßá‡¶ü
            let now = new Date();
            let timeStr = now.getFullYear() + ":" + (now.getMonth()+1).toString().padStart(2,'0') + ":" + now.getDate().toString().padStart(2,'0') + " " + 
                          now.getHours().toString().padStart(2,'0') + ":" + now.getMinutes().toString().padStart(2,'0') + ":" + now.getSeconds().toString().padStart(2,'0');
            
            zeroth[piexif.ImageIFD.DateTime] = timeStr;
            exif[piexif.ExifIFD.DateTimeOriginal] = timeStr;
            exif[piexif.ExifIFD.DateTimeDigitized] = timeStr;

            // ‡¶ú‡¶ø‡¶™‡¶ø‡¶è‡¶∏ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∏‡ßá‡¶ü
            gps[piexif.GPSIFD.GPSLatitudeRef] = userLat < 0 ? 'S' : 'N';
            gps[piexif.GPSIFD.GPSLatitude] = piexif.GPSHelper.degToDmsRational(Math.abs(userLat));
            gps[piexif.GPSIFD.GPSLongitudeRef] = userLng < 0 ? 'W' : 'E';
            gps[piexif.GPSIFD.GPSLongitude] = piexif.GPSHelper.degToDmsRational(Math.abs(userLng));

            let exifObj = {"0th": zeroth, "Exif": exif, "GPS": gps};
            let exifStr = piexif.dump(exifObj);
            let newImage = piexif.insert(exifStr, currentImgData);

            let link = document.createElement('a');
            link.href = newImage;
            link.download = "Proof_" + now.getTime() + ".jpg";
            link.click();
            
            alert("üéâ ‡¶ú‡¶ø‡¶™‡¶ø‡¶è‡¶∏ ‡¶è‡¶¨‡¶Ç ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶á‡¶®‡¶´‡ßã ‡¶≠‡ßá‡¶∞‡¶ø‡¶´‡¶æ‡¶á‡¶°!");
        }
    </script>
</body>
</html>